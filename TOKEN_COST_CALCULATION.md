# Token 成本計算詳解
## 為什麼成本會變動？

---

## 🔢 Token 是什麼？

OpenAI 按 **Token** 計費，不是按「字數」或「次數」。

**Token 計算方式：**
- 英文：1 個單字 ≈ 1-2 tokens
- 中文：1 個字 ≈ 2-3 tokens
- 標點符號：也算 tokens

**範例：**
```
"Hello world" = 2 tokens
"你好世界" = 8 tokens
```

---

## 📊 Wevro 各功能的 Token 消耗

### 1. 例句生成（最變動）

#### Input（Prompt）
```
系統提示詞：~800 tokens（固定）
用戶查詢："create" = ~200 tokens
總 Input：~1,000 tokens
```

#### Output（AI 回應）
```
簡單單字（cat, run）:
- 2 個詞義 × 3 個例句 = ~1,000 tokens
- 1-2 個慣用語 × 2 例句 = ~400 tokens
- 1-2 個搭配詞 × 2 例句 = ~400 tokens
總 Output：~1,800 tokens

複雜單字（procrastinate, serendipity）:
- 3 個詞義 × 6 個例句 = ~3,000 tokens
- 2-3 個慣用語 × 4 例句 = ~1,500 tokens
- 2-3 個搭配詞 × 4 例句 = ~1,500 tokens
總 Output：~6,000 tokens
```

**總 Token 數：**
- 簡單：~2,800 tokens → 成本 $0.015
- 平均：~4,500 tokens → 成本 $0.03
- 複雜：~7,000 tokens → 成本 $0.06

**但是！我們有 `max_completion_tokens: 2500` 限制**
- 最大 Output：2,500 tokens
- 最大總量：~3,500 tokens
- **最大成本：$0.0375**

---

### 2. 同義詞比較

#### Input
```
系統提示詞：~1,000 tokens
用戶查詢："happy" = ~200 tokens
總 Input：~1,200 tokens
```

#### Output
```
簡單單字：
- 3-5 個同義詞 × 2 例句 = ~1,500 tokens

複雜單字：
- 5-7 個同義詞 × 2 例句 = ~3,000 tokens
```

**但有 `max_completion_tokens: 3000` 限制**
- 最大成本：$0.0425

---

### 3. 心智圖擴展（最穩定）

#### Input + Output
```
固定格式：
- Input：~300 tokens
- Output：最多 7 個單字 = ~50 tokens
總計：~350 tokens
成本：$0.0003（使用 gpt-4o-mini）
```

**變動很小！**

---

### 4. 字卡定義（10 張）

#### Input + Output
```
10 個簡單單字：
- Input：~500 tokens
- Output：~600 tokens
總計：~1,100 tokens
成本：$0.0005

10 個複雜單字：
- Input：~500 tokens
- Output：~1,500 tokens
總計：~2,000 tokens
成本：$0.001
```

**有 `max_completion_tokens: 1000` 限制**
- 最大成本：$0.0008

---

## ⚠️ 為什麼定價要考慮最壞情況？

### 情境：重度用戶專查複雜單字

假設 Pro 用戶（180 點）：
- 每次查詢都是複雜單字
- 每次都觸發 max_tokens 上限

**例句：90 次（180 點 ÷ 2）**
```
90 次 × $0.0375（最大成本）= $3.38
收入：$6.99
利潤：$3.61
毛利率：52%
```

**同義詞：90 次（180 點 ÷ 2）**
```
90 次 × $0.0425（最大成本）= $3.83
收入：$6.99
利潤：$3.16
毛利率：45%
```

**混合使用（例句 + 同義詞）：**
```
50 次例句 + 40 次同義詞：
成本：50×$0.0375 + 40×$0.0425 = $3.58
收入：$6.99
利潤：$3.41
毛利率：49%
```

**結論：即使最壞情況，仍有 45-52% 毛利率 ✅**

---

## 🎯 定價合理性

### 例句和同義詞都收 2 點

| 場景 | 實際成本 | 收費（2點） | 毛利率 |
|------|---------|-----------|--------|
| 簡單單字（cat） | $0.015 | $0.20 | **1233%** 🔥 |
| 平均單字（happy） | $0.03 | $0.20 | **567%** |
| 複雜單字（最大） | $0.04 | $0.20 | **400%** |

**所有情況下毛利率都很高！**

---

## 📊 實際使用數據預測

根據教育 App 統計：
- 70% 查詢：簡單-中等單字
- 25% 查詢：中等-複雜單字
- 5% 查詢：非常複雜單字

**加權平均成本：**
```
例句：
0.7×$0.02 + 0.25×$0.035 + 0.05×$0.04 = $0.025

同義詞：
0.7×$0.025 + 0.25×$0.04 + 0.05×$0.045 = $0.03

= 比我們的「最壞情況」估算還低！
```

---

## ✅ 結論

### 為什麼統一定價（2 點）合理？

1. ✅ **成本相近**：平均差異只有 16-20%
2. ✅ **有上限保護**：`max_completion_tokens` 防止爆炸
3. ✅ **用戶友好**：統一定價容易理解
4. ✅ **毛利率高**：所有情況下都 >400%

### 最終定價（已調整）

| 功能 | 點數消耗 | 最低成本 | 平均成本 | 最高成本 |
|------|---------|---------|---------|---------|
| 心智圖擴展 | **免費** | $0.0002 | $0.0003 | $0.0005 |
| 字卡生成（10張）| **1 點** | $0.0004 | $0.0006 | $0.001 |
| 例句生成 | **2 點** | $0.015 | $0.03 | $0.0375 |
| 同義詞比較 | **2 點** | $0.018 | $0.035 | $0.0425 |

**手續費考慮（App Store 30%）：**
```
2 點價值：$0.20
扣除手續費：$0.20 × 70% = $0.14
最大成本：$0.0425
淨利：$0.0975
毛利率：230% ✅ 仍然很健康！
```

